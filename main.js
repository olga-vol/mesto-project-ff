(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-32",headers:{authorization:"178ed554-084f-4e65-8b16-6b2ef34ddbc6","Content-Type":"application/json"}};function t(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var n=document.querySelector("#card-template").content;function o(n,o){var r,c=n.target.closest(".places__item");console.log(o),o.hasOwnProperty("_id")&&(r=o._id,fetch("".concat(e.baseUrl,"/cards/").concat(r),{method:"DELETE",headers:e.headers}).then(t)).then((function(){c.remove()})).catch((function(e){console.log(e.status)}))}function r(n,o){var r,c=n.target.closest(".card__like").querySelector(".card__like-p");n.target.classList.contains("card__like-button_is-active")?(r=o._id,fetch("".concat(e.baseUrl,"/cards/likes/").concat(r),{method:"DELETE",headers:e.headers}).then(t)).then((function(e){c.textContent=e.likes.length,n.target.classList.contains("card__like-button")&&n.target.classList.toggle("card__like-button_is-active")})).catch((function(e){console.log(e.status)})):function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:e.headers}).then(t)}(o._id).then((function(e){c.textContent=e.likes.length,n.target.classList.contains("card__like-button")&&n.target.classList.toggle("card__like-button_is-active")})).catch((function(e){console.log(e.status)}))}function c(e,t,o,r,c){var a=n.querySelector(".card").cloneNode(!0),i=a.querySelector(".card__like-button"),s=a.querySelector(".card__image");s.src=e.link,s.alt=e.name,a.querySelector(".card__title").textContent=e.name;var u=a.querySelector(".card__delete-button");u.addEventListener("click",(function(n){t(n,e)})),i.addEventListener("click",(function(t){o(t,e)})),a.addEventListener("click",r);var l=a.querySelector(".card__like-p");return e.hasOwnProperty("likes")?(l.textContent=e.likes.length,e.likes.map((function(e){return e._id})).includes(c)&&i.classList.add("card__like-button_is-active")):l.textContent=0,e.hasOwnProperty("owner")&&e.owner._id!==c&&u.classList.add("card__delete-button_hide"),a}function a(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",s)}function i(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",s)}function s(e){"Escape"===e.key&&i(document.querySelector(".popup_is-opened"))}function u(e,t){!e.target.classList.contains("popup__content")&&e.target.classList.contains("popup_is-opened")&&i(t)}function l(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}function d(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(n.inactiveButtonClass)):(e.disabled=!0,e.classList.add(n.inactiveButtonClass))}function p(e,t){var n=e.querySelector(t.submitButtonSelector);n.disabled=!0,n.classList.add(t.inactiveButtonClass),Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(n){l(e,n,t)}))}var _,f={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},m=document.querySelector(".places__list"),v=document.querySelectorAll(".popup"),h=document.querySelector(".popup_type_image"),y=h.querySelector(".popup__image"),S=h.querySelector(".popup__caption"),b=h.querySelector(".popup__close"),g=document.querySelector(".profile__edit-button"),L=document.querySelector(".popup_type_edit"),k=document.forms["edit-profile"],q=L.querySelector(".popup__button"),E=k.elements.name,C=k.elements.description,x=L.querySelector(".popup__close"),w=document.querySelector(".popup_type_avatar"),A=w.querySelector(".popup__close"),U=document.forms["edit-avatar"],P=U.querySelector(".popup__button"),B=document.querySelector(".profile__title"),O=document.querySelector(".profile__description"),T=document.querySelector(".profile__image"),D=document.querySelector(".profile__add-button"),N=document.querySelector(".popup_type_new-card"),j=N.querySelector(".popup__close"),J=document.forms["new-place"],M=J.querySelector(".popup__button");function H(e){var t=e.target.src,n=e.target.alt;y.src=t,y.alt=n,S.textContent=n,e.target.classList.contains("card__image")&&a(h)}function I(e,t){t.textContent=e?"Сохранение...":"Сохранить"}Promise.all([fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then(t),fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then(t)]).then((function(e){var t=Array.from(e[0]);_=e[1]._id,B.textContent=e[1].name,O.textContent=e[1].about,T.style.backgroundImage="url(".concat(e[1].avatar,")"),t.forEach((function(e){m.append(c(e,o,r,H,_))}))})).catch((function(e){return console.log(e)})),h.addEventListener("click",(function(e){u(e,h)})),b.addEventListener("click",(function(){i(h)})),v.forEach((function(e){e.classList.add("popup_is-animated")})),g.addEventListener("click",(function(){p(L,f),a(L),E.value=B.textContent,C.value=O.textContent})),L.addEventListener("click",(function(e){u(e,L)})),x.addEventListener("click",(function(){i(L)})),k.addEventListener("submit",(function(n){n.preventDefault(),I(!0,q);var o,r,c=E.value,a=C.value;(o=c,r=a,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:o,about:r})}).then(t)).then((function(){B.textContent=c,O.textContent=a,i(L)})).catch((function(e){return console.log(e)})).finally((function(){return I(!1,q)}))})),D.addEventListener("click",(function(){a(N)})),N.addEventListener("click",(function(e){u(e,N)})),j.addEventListener("click",(function(){i(N)})),J.addEventListener("submit",(function(n){var a=J.elements["place-name"],s=J.elements.link;I(!0,M),n.preventDefault(),function(n,o){return fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:n,link:o})}).then(t)}(a.value,s.value).then((function(e){m.prepend(c(e,o,r,H,_)),i(N),J.reset(),p(J,f)})).catch((function(e){return console.log(e)})).finally((function(){return I(!1,M)}))})),T.addEventListener("click",(function(){a(w)})),w.addEventListener("click",(function(e){u(e,w)})),A.addEventListener("click",(function(){i(w)})),U.addEventListener("submit",(function(n){I(!0,P);var o,r=U.elements.url.value;n.preventDefault(),(o=r,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:o})}).then(t)).then((function(){T.style.backgroundImage="url(".concat(r,")"),i(w),U.reset(),p(U,f)})).catch((function(e){return console.log(e)})).finally((function(){return I(!1,P)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);d(o,n,t),n.forEach((function(r){r.addEventListener("input",(function(){(function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?l(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));console.log(t.id),t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)})(e,r,t),d(o,n,t)}))}))}(t,e)}))}(f)})();