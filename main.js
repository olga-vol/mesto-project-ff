(()=>{"use strict";var e,t={baseUrl:"https://nomoreparties.co/v1/wff-cohort-32",headers:{authorization:"178ed554-084f-4e65-8b16-6b2ef34ddbc6","Content-Type":"application/json"}};function n(e,t){t.textContent=e?"Сохранение...":"Сохранить"}var o=document.querySelector("#card-template").content;function r(e,n){var o;e.target.closest(".places__item").remove(),n.hasOwnProperty("_id")&&(o=n._id,fetch("".concat(t.baseUrl,"/cards/").concat(o),{method:"DELETE",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e.status)})))}function c(e,n){var o,r,c=e.target.closest(".card__like").querySelector(".card__like-p");n.hasOwnProperty("_id")&&(e.target.classList.contains("card__like-button_is-active")?(o=n._id,r=c,fetch("".concat(t.baseUrl,"/cards/likes/").concat(o),{method:"DELETE",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){r.textContent=e.likes.length,console.log(e.likes.length)})).catch((function(e){console.log(e.status)}))):function(e,n){fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){n.textContent=e.likes.length})).catch((function(e){console.log(e.status)}))}(n._id,c)),e.target.classList.contains("card__like-button")&&e.target.classList.toggle("card__like-button_is-active")}function a(e,t,n,r,c){var a=o.querySelector(".card").cloneNode(!0),s=a.querySelector(".card__like-button"),i=a.querySelector(".card__image");i.src=e.link,i.alt=e.name,a.querySelector(".card__title").textContent=e.name;var u=a.querySelector(".card__delete-button");u.addEventListener("click",(function(n){t(n,e)})),s.addEventListener("click",(function(t){n(t,e)})),a.addEventListener("click",r);var l=a.querySelector(".card__like-p");return e.hasOwnProperty("likes")?(l.textContent=e.likes.length,e.likes.map((function(e){return e._id})).includes(c)&&s.classList.add("card__like-button_is-active")):l.textContent=0,e.hasOwnProperty("owner")&&e.owner._id!==c&&u.classList.add("card__delete-button_hide"),a}function s(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",u)}function i(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",u)}function u(e){"Escape"===e.key&&i(document.querySelector(".popup_is-opened"))}function l(e,t){!e.target.classList.contains("popup__content")&&e.target.classList.contains("popup_is-opened")&&i(t)}var d={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"};function p(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(d.inputErrorClass),n.classList.remove(d.errorClass),n.textContent=""}function f(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(d.inactiveButtonClass)):(e.disabled=!0,e.classList.add(d.inactiveButtonClass))}function _(e){var t=Array.from(e.querySelectorAll(d.inputSelector)),n=e.querySelector(d.submitButtonSelector);f(n,t),t.forEach((function(o){o.addEventListener("input",(function(){(function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?p(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));console.log(t.id),t.classList.add(d.inputErrorClass),o.textContent=n,o.classList.add(d.errorClass)}(e,t,t.validationMessage)})(e,o),f(n,t)}))}))}function m(e,t){var n=e.querySelector(t.submitButtonSelector);n.disabled=!0,n.classList.add(t.inactiveButtonClass),Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(t){p(e,t)}))}var v,h,y,S=document.querySelector(".places__list"),k=document.querySelectorAll(".popup"),b=document.querySelector(".popup_type_image"),g=b.querySelector(".popup__image"),L=b.querySelector(".popup__caption"),q=b.querySelector(".popup__close"),E=document.querySelector(".profile__edit-button"),C=document.querySelector(".popup_type_edit"),j=document.forms["edit-profile"],P=C.querySelector(".popup__button"),x=j.elements.name,w=j.elements.description,U=C.querySelector(".popup__close"),A=document.querySelector(".popup_type_avatar"),O=A.querySelector(".popup__close"),B=document.forms["edit-avatar"],T=B.querySelector(".popup__button"),D=document.querySelector(".profile__title"),N=document.querySelector(".profile__description"),J=document.querySelector(".profile__image"),M=document.querySelector(".profile__add-button"),H=document.querySelector(".popup_type_new-card"),I=H.querySelector(".popup__close"),V=document.forms["new-place"],z=V.querySelector(".popup__button");function F(e){var t=e.target.src,n=e.target.alt;g.src=t,g.alt=n,L.textContent=n,e.target.classList.contains("card__image")&&s(b)}v=D,h=N,y=J,fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(t){v.textContent=t.name,h.textContent=t.about,y.style.backgroundImage="url(".concat(t.avatar,")"),e=t._id})).catch((function(e){return console.log(e)})),function(e,n,o,r,c){Promise.all(["".concat(t.baseUrl,"/cards"),"".concat(t.baseUrl,"/users/me")].map((function(e){return fetch(e,{headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}))).then((function(t){var a=Array.from(t[0]),s=t[1]._id;a.forEach((function(t){e.append(n(t,o,r,c,s))}))})).catch((function(e){return console.log(e)}))}(S,a,r,c,F),b.addEventListener("click",(function(e){l(e,b)})),q.addEventListener("click",(function(){i(b)})),k.forEach((function(e){e.classList.add("popup_is-animated")})),E.addEventListener("click",(function(){m(C,d),s(C),x.value=D.textContent,w.value=N.textContent})),C.addEventListener("click",(function(e){l(e,C)})),U.addEventListener("click",(function(){i(C)})),j.addEventListener("submit",(function(e){e.preventDefault(),n(!0,P);var o,r,c,a=x.value,s=w.value;D.textContent=a,N.textContent=s,i(C),o=a,r=s,c=P,fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:o,about:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)})).finally((function(){return n(!1,c)}))})),M.addEventListener("click",(function(){s(H)})),H.addEventListener("click",(function(e){l(e,H)})),I.addEventListener("click",(function(){i(H)})),V.addEventListener("submit",(function(o){var s=V.elements["place-name"],u=V.elements.link,l={name:s.value,link:u.value};n(!0,z),o.preventDefault(),S.prepend(a(l,r,c,F,e)),function(e,o,r){fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:e,link:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)})).finally((function(){return n(!1,r)}))}(s.value,u.value,z),i(H),V.reset(),m(V,d)})),J.addEventListener("click",(function(){s(A)})),A.addEventListener("click",(function(e){l(e,A)})),O.addEventListener("click",(function(){i(A)})),B.addEventListener("submit",(function(e){n(!0,T);var o,r,c=B.elements.url.value;e.preventDefault(),o=c,r=T,fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:o})}).then((function(e){return e.ok?e.json:Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)})).finally((function(){return n(!1,r)})),J.style.backgroundImage="url(".concat(c,")"),i(A),B.reset(),m(B,d)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(e){_(e)}))}(d)})();